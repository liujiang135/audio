<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" type="text/css" href="./css/common.css">
  <link rel="stylesheet" type="text/css" href="./css/index.css">
  <title>OHOS-Cleaner</title>
</head>

<body>
  <div id="app">
    <!-- 头部导航栏 -->
    <header class="header">
      <div class="headerWrap">
        <div class="iphoneStatus"></div>
        <div class="devTitle">
          <div class="barLeft">
            <div class="goApp"></div>
          </div>
          <div class="devName" data-loacle="index.header.headerWrap.devName">
            <span class="cn_lang">清蜓智能随手吸尘器C2S</span>
            <span class="en_lang">Smart Vacuum C2S</span>
          </div>
          <div class="barRight">
            <div class="devMore"></div>
          </div>
        </div>
      </div>
    </header>

    <div class="appMargin">
      <!-- 设备图片+logo -->
      <section class="devImg">

        <div class="devTop">
          <div class="devTopWrap">
            <div class="devTopLeft">
              <div class="msgIcon"></div>
            </div>
            <div class="devTopMsg replaceLv" data-loacle="devTopMsg">
              <span class="cn_lang">请更换滤芯</span>
              <br class="cn_lang cn_lang_br">
              <span class="cn_lang">更换完成后请手动重置滤芯</span>
              <span class="en_lang">Please replace the filter. After replacement, please reset the filter
                  manually.</span>
            </div>
            <div class="devTopMsg lowBatteryLv" data-loacle="devTopMsg" display:none>
              <span class="cn_lang">电量低，请充电!</span>
              <span class="en_lang">Low battery, please charge it!</span>
            </div>
            <div class="devTopMsg clearLv" data-loacle="devTopMsg">
              <span class="cn_lang">请清理尘杯及滤芯!</span>
              <span class="en_lang">Please clean the dust cup and the filter!</span>
            </div>
            <div class="devTopRight">
              <div class="msgIcon"></div>
            </div>
          </div>
        </div>
        <div class="deviceImg"></div>
        <div class="logo"></div>
      </section>

      <!-- <section class="test" style="display: none;">
        <input type="text" class="input1">
        <button class="sendBtn">发送</button>
        <div class="receive">接收值：</div>
      </section> -->

      <!-- 设备状态栏-->
      <section class="devStatus">
        <!-- <div class="statusLeft" data-locale="statusLeft_unconnect">已连接</div> -->
        <div class="statusLeft" data-locale="statusLeft_unconnect">
          <span class="cn_lang">工作中</span>
          <span class="en_lang">Working</span>
        </div>
        <!-- <div class="statusLeft" data-locale="statusLeft_unconnect">待机</div> -->
        <!-- <div class="statusLeft" data-locale="statusLeft_unconnect">连接中</div> -->
        <!-- <div class="statusLeft" data-locale="statusLeft_unconnect">未连接</div>  -->
        <div class="statusMiddle">
          <div class="up batterNum disable" data-locale="turned_on">100%</div>
          <div class="down batterStatus disable" data-locale="turned_on">
            <span class="cn_lang">电池电量</span>
            <span class="en_lang">Batter</span>
          </div>
        </div>
        <div class="statusRight">
          <div class="statusImg"></div>
          <div class="statusImg statusImgLoading"></div>
          <div class="statusTxt">
            <span class="cn_lang">重新连接</span>
            <span class="en_lang">Reconnect</span>
          </div>
        </div>
      </section>
      <!-- 信息展示区 -->
      <section class="devInfo">
        <ul class="infoList ">
          <!-- <li class="infoItem">
                        <div class="infoWrap">
                            <p class="infoNum">
                                <span class="number">2</span>
                                <span class="unit">%</span>
                            </p>
                            <p class="infoName">信息展示</p>
                        </div>
                    </li>
                    <div class="infoLine"></div> -->
          <li class="infoItem">
            <div class="infoWrap">
              <p class="infoNum workTime">
                <span class="number lastcleanmin">-</span>
                <span class="unit">
                    <span class="cn_lang">分</span>
                <span class="en_lang">min</span>
                </span>
                <span class="number lastcleansecond">-</span>
                <span class="unit">
                    <span class="cn_lang">秒</span>
                <span class="en_lang">s</span>
                </span>
                <!-- <span class="number">-</span>
                                <span class="unit"></span>
                                <span class="number">-</span>
                                <span class="unit"></span> -->
              </p>
              <p class="infoNum initTime">
                <span class="number">-</span>
                <span class="unit"></span>
                <span class="number">-</span>
                <span class="unit"></span>
              </p>
              <p class="infoName">
                <span class="cn_lang">上次清扫时间</span>
                <span class="en_lang">Last cleaning time</span>
              </p>
            </div>
          </li>
          <div class="infoLine"></div>
          <li class="infoItem">
            <div class="infoWrap">
              <p class="infoNum workTime">
                <span class="number allcleanmin">-</span>
                <span class="unit">
                    <span class="cn_lang">分</span>
                <span class="en_lang">min</span>
                </span>
                <span class="number allcleansecond">-</span>
                <span class="unit">
                    <span class="cn_lang">秒</span>
                <span class="en_lang">s</span>
                </span>
                <!-- <span class="number">-</span>
                                <span class="unit"></span>
                                <span class="number">-</span>
                                <span class="unit"></span> -->
              </p>
              <p class="infoNum initTime">
                <span class="number">-</span>
                <span class="unit"></span>
                <span class="number">-</span>
                <span class="unit"></span>
              </p>
              <p class="infoName">
                <span class="cn_lang">累计清扫时间</span>
                <span class="en_lang">Cumulative usage time</span>
              </p>
            </div>
          </li>
        </ul>
      </section>
      <!-- 功能操作区 -->
      <section class="devFn">
        <ul class="fnList">

          <li class="fnItem spinner">
            <div class="fnWrap">
              <p class="fnName">
                <span class="cn_lang">模式</span>
                <span class="en_lang">Mode</span>
              </p>
              <p class="fnStatus modeTip">
                <span class="cn_lang">节能模式</span>
                <span class="en_lang">ECO Mode</span>
              </p>
            </div>
            <div class="fnBox">
              <div class="fnImg fnImgItem3"></div>
            </div>
            <ul class="spinnerWrap appear">
              <li class="spinnerList checkedBg checkedText" id="eco">
                <span class="cn_lang">节能模式</span>
                <span class="en_lang">ECO Mode</span>
              </li>
              <li class="spinnerList" id="turbo">
                <span class="cn_lang">强劲模式</span>
                <span class="en_lang">Turbo Mode</span>
              </li>
              <!--    <li class="spinnerList checkedBg">3档</li>
                            <li class="spinnerList">4档</li>
                            <li class="spinnerList">5档</li>
                            <li class="spinnerList">6档</li>
                            <li class="spinnerList">7档</li> -->
            </ul>
          </li>


          <li class="fnItem ledCard">
            <div class="fnWrap">
              <p class="fnName">
                <span class="cn_lang">LED照明</span>
                <span class="en_lang">LED Lighting</span>
              </p>
              <p class="fnStatus ledTip">
                <span class="cn_lang">已开启</span>
                <span class="en_lang">Activated</span>
              </p>
            </div>
            <div class="fnBox">
              <div class="fnImg fnImgItem2"></div>
              <!-- <img class="fnImg" src="./img/light/ic_huanqi_blue.png"></img> -->
            </div>
          </li>

          <li class="fnItem lvInfo">
            <div class="fnWrap">
              <p class="fnName">
                <span class="cn_lang">滤芯信息</span>
                <span class="en_lang">Filter Information</span>
              </p>
            </div>
            <div class="fnBox">
              <div class="fnImg fnImgItem1"></div>
              <!-- <img class="fnImg" src="./img/light/ic_countdown.png"></img> -->
            </div>
          </li>

          <li class="fnItem instructions">
            <div class="fnWrap">
              <p class="fnName">
                <span class="cn_lang">使用说明</span>
                <span class="en_lang">Manual</span>
              </p>
            </div>
            <div class="fnBox">
              <div class="fnImg fnImgItem4"></div>
              <!-- <img class="fnImg" src="./img/light/ic_countdown.png"></img> -->
            </div>
          </li>


          <!-- <li class="fnItem singleList">
                        <div class="fnWrap">
                            <p class="fnName">底部弹窗</p>
                        </div>
                        <div class="fnBox">
                            <div class="fnImg fnImgItem4"></div>
                        </div>
                    </li>
                    <li class="fnItem">
                        <div class="fnWrap">
                            <p class="fnName">滑动开关</p>
                            <p class="fnSubtitle">长卡片</p>
                        </div>
                        <div class="fnBox">
                            <div class="fnSlider">
                                <div class="sliderBtn"></div>
                            </div>
                        </div>
                        
                    </li> -->
        </ul>

        <!-- <div class="sliderBar">
                    <div class="sliderWrap">
                        <p class="sliderName">滑动条</p>
                        <p class="sliderStatus">11%</p>
                    </div>
                    <div class="rangWrap">
                        <div class="rang"> 
                            <div class="stripLeft"></div>
                            <div class="stripRight"></div>
                            <div class="slider"></div>
                        </div>
                    </div>
                </div>

                <div class="statement">
                    <div class="stateWrap">
                        <p class="stateName">隐私协议</p>
                    </div>
                    <div class="stateBox">
                        <div class="stateImg"></div>
                    </div>
                </div>-->
      </section>

      <section class="devRecord">
        <div class="devRecordWrap">
          <div class="recordTitleWrap">
            <p class="recordTitle">
              <span class="cn_lang">近3次清扫记录</span>
              <span class="en_lang">Records of the last three cleanings</span>
            </p>
          </div>
          <div class="recordEmptyList">
            <div class="recordEmptyImg"></div>
            <div class="recordEmptyTxt">
              <span class="cn_lang">暂无记录</span>
              <span class="en_lang">No record</span>
            </div>
          </div>
          <ul class="recordList">
            <!-- <li class="recordItem">
              <div class="recordLeft">
                <p class="circle">34</p>
              </div>
              <div class="recordMiddle">
                <p class="up">
                  <span class="cn_lang">清扫时长</span>
                  <span class="en_lang">Cleaning time</span>
                </p>
                <p class="down historyworkDate">2021/11/12 14:26</p>
              </div>
              <div class="recordRight">
                <span class="cn_lang historyworkTime">2分48秒</span>
                <span class="en_lang historyworkTime">2min48s</span>
              </div>
            </li>
            <div class="linebox">
              <div class="line"></div>
            </div> -->
          </ul>
        </div>
      </section>

    </div>




    <!-- 模式列表弹窗 -->
    <div class="modeList modeListAppear">
      <div class="modeWrap">
        <div class="modeTitle">模式列表</div>
        <ul>
          <li class="modeItem">
            <div class="modeName">节能模式</div>
            <div class="modeImg modeImgOff"></div>
            <!-- <img class="modeImg" src="./img/light/public/Radiobtn_off.png"></img> -->
          </li>
          <li class="modeItem">
            <div class="modeName">流光模式</div>
            <div class="modeImg modeImgOn"></div>
            <!-- <img class="modeImg" src="./img/light/public/Radiobtn_on.png"></img> -->
          </li>
          <li class="modeItem">
            <div class="modeName">七彩模式</div>
            <div class="modeImg modeImgOff"></div>
          </li>
          <li class="modeItem">
            <div class="modeName">温馨模式</div>
            <div class="modeImg modeImgOff"></div>
          </li>
        </ul>

        <div class="bottomBtn">
          <div class="fnbtn">取消</div>
          <div class="line"></div>
          <div class="fnbtn">确定</div>
        </div>
      </div>

    </div>

    <!-- 隐私协议弹窗 -->
    <div class="statementPopup">
      <div class="statementWrap">
        <div class="statementTitle">
          <span class="cn_lang">隐私声明</span>
          <span class="en_lang">Privacy statement</span>
        </div>
        <div class="statementContent">
          <div class="statementBox">
            <p class="">
              <span class="cn_lang">北京众清科技有限公司向您提供蜻蜓智能随手吸产品的蓝牙连接服务，请您务必认真阅读本声明，在确认充分了解并同意后使用我们的产品和服务。如果您不同意声明的内容， 您应当立即停止使用。</span>
              <span class="en_lang">Beijing Zhongqing Technology Co., Ltd. provides you with bluetooth connection service of Dragonfly Intelligent Suction product. Please be sure to read this statement carefully and use our products and services after confirming your full understanding and consent. If you do not agree with the content of the statement, you should stop using it immediately.</span>
            </p>
            <div class="stateRules">
              <p>
                <span class="cn_lang">在我们向您提供产品和服务的过程中，我们需要收集您的以下信息：</span>
                <span class="en_lang">In the process of providing our products and services to you, we need to collect the following information from you:</span>
              </p>
              <p>
                <span class="cn_lang">1.为了实现使用记录统计功能，我们会会收集您使用本产品的数据，包括：使用时间，使用时长。</span>
                <span class="en_lang">1. In order to realize the statistical function of usage record, we will collect the data of your use of this product, including: usage time and usage duration.</span>
              </p>
            </div>
            <p>
              <span class="cn_lang">点击“同意”，即代表您已充分了解并同意上述内容。</span>
              <span class="en_lang">Clicking "Agree" means that you have fully understood and agreed to the above content</span>
            </p>
          </div>
        </div>
        <div class="stateBtn">
          <div class="stateFn btn_l">
            <span class="cn_lang">取消</span>
            <span class="en_lang">Cancel</span>
          </div>
          <div class="line"></div>
          <div class="stateFn btn_r">
            <span class="cn_lang">同意</span>
            <span class="en_lang">Agree</span>
          </div>
        </div>
      </div>
    </div>

    <!-- 氛围灯迁移过来的 -->
    <div class="shelter" display="block"></div>
    <div class="msg-div" display="block">
      <div class="msg-main">
        <div class="msg-title" data-locale="connect_fail">
          <span class="cn_lang">连接超时</span>
          <span class="en_lang">Connection timed out</span>
        </div>
        <p class="msg-content">
          <span class="cn_lang" data-locale="try_again">请尝试以下操作：</span>
          <br class="cn_lang cn_lang_br">
          <span data-locale="tip1">
              <span class="cn_lang">1.请确认设备接通电源并处开机状态</span>
          <span class="en_lang">1. Confrm that the batter power is normal.</span>
          </span>
          <br>
          <span data-locale="tip2">
              <span class="cn_lang">2.将手机靠近设备 </span>
          <span class="en_lang">2. Place the phone close to the device.</span>
          </span>
          <br>
          <span data-locale="tip3">
              <span class="cn_lang">3.重启手机蓝牙</span>
          <span class="en_lang">3. Restar phone Bluetooth</span>
          </span>
        </p>
        <div class="msg-footer">
          <div class="btn_ok btn_l cancleConnectFail" id="btn_ok">
            <span class="cn_lang">稍后重试</span>
            <span class="en_lang">Tr Again</span>
          </div>
          <div class="line"></div>
          <div class="btn_ok btn_r connectFailBtn" id="btn_ok">
            <span class="cn_lang">重新连接</span>
            <span class="en_lang">Reconnect</span>
          </div>
        </div>
      </div>
    </div>
    <!-- 氛围灯迁移过来的 end -->

    <div class="backgroundColor"></div>
    <div class="addHeight"></div>

    <!-- <div class="chuxuanx" style="display: none;"></div> -->
    <div class="chuxuanx"></div>
    <div class="xuanxiang" style="display: none;">
      <div class="guanbix">关闭</div>
      <ul>
        <li>语言：
          <input type="radio" value="zh" name="lang">中文
          <input type="radio" value="en" name="lang">英文
        </li>

        <li>主题色：
          <input type="radio" value="anhei" name="yanse">暗黑
          <input type="radio" value="baitian" name="yanse">白天
        </li>

        <li>模式：
          <input type="radio" value="0" name="moshi">未连接
          <input type="radio" value="2" name="moshi">连接超时
          <input type="radio" value="5" name="moshi">工作中
          <input type="radio" value="6" name="moshi">连接中
          <input type="radio" value="7" name="moshi">待机
          <!-- <input type="radio" value="1" name="moshi">重连 -->
        </li>

        <li>告警：
          <input type="radio" value="0" name="gaojing1">请更换滤芯
          <input type="radio" value="1" name="gaojing1">电量低，请充电
          <input type="radio" value="2" name="gaojing1">请清理尘杯及滤芯！
          <input type="radio" value="4" name="gaojing1">多条警告！
          <input type="radio" value="3" name="gaojing1">隐藏警告
        </li>

        <li>
          <input type="radio" value="1" name="shange1">栅格化
          <input type="radio" value="2" name="shange1">正常
        </li>
        <li>
          <input type="radio" value="1" name="yinsisss">隐私声明
        </li>


        <li>
          <button class="queding">确定</button>
        </li>
      </ul>

    </div>
  </div>
</body>


<script src="./js/jquery.min.js"></script>
<!-- <script src="./js/jquery.i18n.properties.js"></script> -->
<script src="./js/vconsole.min.js"></script>
<script src='./js/ble.js'></script>
<script src='./js/index.js'></script>
<script>
  var vConsole = new VConsole();
  console.log('-index.html-');
  // 中文 zh   英文 en
  var ctLanguage = 'en'; // 语言
  ctLanguage = 'zh';


  var isIOS = !!navigator.userAgent.match(/iPhone/i);
  console.log('iOS:' + isIOS);

  if (isIOS) {
    $(".devMore").hide()
  } else {
    $(".devMore").show()
  }

  // 中英文切换
  function loadProperties(lang) {
    console.log("loadProperties:" + lang)
    ctLanguage = lang;
    sessionStorage.setItem('ctLanguage', ctLanguage);
    if (ctLanguage == 'en') {
      $('.cn_lang').hide();
      $('.en_lang').show();
    }
  }

  function getDarkMode(dark) {
    console.log("getDarkMode")
    var isIOS = !!navigator.userAgent.match(/iPhone/i);

    // if(window.hilink && !isIOS){
    if (true) {
      // var dark = window.hilink.getDarkMode();
      // var dark = 2;
      if (dark == 2) { //暗黑模式
        app.style.background = 'black';
        app.classList.add("dark");
        document.body.classList.add("dark")
      } else {
        app.style.background = '#F1F3F5';
        app.classList.remove("dark")
        document.body.classList.remove("dark")
      }
    }
  }

  $('.instructions').click(function() {
    console.log('-使用说明--')
    window.open('./intro.html')
      // disconnectBleFun();
  })

  $('.lvInfo,.replaceLv,.devTopRight').click(function() {
      console.log('-滤芯信息--')
      let t = (new Date()).getTime()
      console.log('t--', t)
      window.open('./lvxin.html?t=' + t)
    })
    // 发送数据
  function sendCommand(code) {
    let sendCode = '';
    // 计算校验位 start
    let b0 = code.substr(2, 2);
    let b1 = code.substr(4, 2);
    let b2 = code.substr(6, 2);
    let b3 = code.substr(8, 2);
    let b4 = code.substr(10, 2);
    let b5 = code.substr(12, 2);
    let b6 = code.substr(14, 2);
    // console.log('16进制code-', b0, b1, b2, b3, b4, b5, b6)

    let bx0 = parseInt(b0, 16);
    let bx1 = parseInt(b1, 16);
    let bx2 = parseInt(b2, 16);
    let bx3 = parseInt(b3, 16);
    let bx4 = parseInt(b4, 16);
    let bx5 = parseInt(b5, 16);
    let bx6 = parseInt(b6, 16);
    // console.log('10进制code-', bx0, bx1, bx2, bx3, bx4, bx5, bx6)
    let sum0 = bx0 + bx1 + bx2 + bx3 + bx4 + bx5 + bx6;
    // console.log('10进制code和-', sum0)
    let sum = '0x' + sum0.toString(16);
    // console.log('16进制code和-', sum)
    let gao = (sum & 0xF0).toString(16);
    let di = (sum & 0x0F).toString(16);
    // console.log('高位：', gao, '低位：', di);
    let lg = gao.toString().length;
    let ld = di.toString().length;
    if (lg == 1) {
      sendCode = code + '0' + gao
    } else {
      sendCode = code + gao
    }
    if (ld == 1) {
      sendCode = sendCode + '0' + di + 'FB'
    } else {
      sendCode = sendCode + di + 'FB'
    }
    // 计算校验位 end   组装数据ok 
    let obj = {
      "t": 01,
      "v": (sendCode.toUpperCase())
    }
    let inputVal = JSON.stringify(obj)
    console.log('--下发数据--:', inputVal)
    window.hilink.sendCommand(hilinkDevId, deviceIdMac, 'test', inputVal,
      'sendCommandCallback');
    window.sendCommandCallback = res => {
      let data = dataChange(res);
      console.log('写数据给模块信息，回调:', data);
    }
  }

  // 开始工作按钮可以点击
  $('.statusImg').click(function() {
    console.log('开始工作--切换至工作中')
      // 待机状态时，点击开始工作--切换至工作中
    if (sessionStorage.getItem('initCode') == 7) {
      console.log('-发-开机')
      sendCommand("FA01060401000000")
    }
    if (sessionStorage.getItem('initCode') == 5) {
      console.log('-发-关机')
      sendCommand("FA01060400000000")
    }
  })
  $('#eco').click(function() {
    console.log('-发-节能模式')
    sendCommand("FA01050400000000")
  })
  $('#turbo').click(function() {
    console.log('-发-强劲模式')
    sendCommand("FA01050401000000")
  })

  // LED开关
  $('.ledCard').click(function() {
    console.log('LED开关')
    if (window.hilink.getStorageSync('ledCode') == 1) {
      console.log('-发-关灯')
      sendCommand("FA01080400000000")
    } else {
      console.log('-发-开灯')
      sendCommand("FA01080401000000")
    }
  })

  $(".devMore").click(function() {
    console.log('设置')
    window.hilink.jumpTo('com.huawei.smarthome.deviceSettingActivity', 'jumpToCallback')
    window.jumpToCallback = res => {
      let data = dataChange(res);
      console.log('设置res:', data);
    }
  })

  $(".cancleConnectFail").click(function() {
    console.log('稍后重试')
    $('.shelter').hide();
    $('.msg-div').hide();
  })

  $(".connectFailBtn,.statusTxt").click(function() {
    console.log('重新连接')
    isDiscover = false;
    connectBleInit();
  })

  // 移出高亮显示状态
  function removeDisableStatus() {
    // 设置禁用状态
    this.document.getElementsByClassName("devInfo")[0].classList.remove('disable');
    this.document.getElementsByClassName("spinner")[0].classList.remove('disable');
    this.document.getElementsByClassName("ledCard")[0].classList.remove('disable');
    this.document.getElementsByClassName("lvInfo")[0].classList.remove('disable');
    this.document.getElementsByClassName("devRecord")[0].classList.remove('disable');
  }

  // 初始化未连接之前的状态
  function clearDataToStart() {
    // 隐藏电池电量
    $('.statusMiddle').hide();
    // 隐藏上次清扫时间
    $('.workTime').hide();
    $('.initTime').show();

    // 连接中 icon 隐藏
    $('.statusImgLoading').hide();
    // 移除禁用状态。全部控件可用
    removeDisableStatus()
  }
  // ‘未连接’时禁用部分控件
  function disableControls() {
    this.document.getElementsByClassName("devInfo")[0].classList.add('disable');
    this.document.getElementsByClassName("spinner")[0].classList.add('disable');
    this.document.getElementsByClassName("ledCard")[0].classList.add('disable');
    this.document.getElementsByClassName("lvInfo")[0].classList.add('disable');
    this.document.getElementsByClassName("devRecord")[0].classList.add('disable');
  }

  let workStatus = 0; //
  let recordStatus = 0 //0 没几率 ，1 三条记录

  // 设置状态
  function initStatus(workStatus, recordStatus, batterFlag) {
    console.log('模式', workStatus)
    if (workStatus == 0) { //未连接
      clearDataToStart();
      if (ctLanguage == 'en') {
        this.document.getElementsByClassName("statusLeft")[0].innerText = "Disconnected";
      } else {
        this.document.getElementsByClassName("statusLeft")[0].innerText = "未连接";
      }
      // 显示'重新连接',隐藏'工作中'图标
      this.document.getElementsByClassName("statusTxt")[0].style.display = "block";
      this.document.getElementsByClassName("statusImg")[0].style.display = "none";
      // 关闭超时连接弹框
      $('.shelter').hide();
      $('.msg-div').hide();
      // 设置禁用状态
      disableControls();
    } else if (workStatus == 1) { //重连
      //TODO
      clearDataToStart();
    } else if (workStatus == 2) { //连接失败 --> 连接超时
      clearDataToStart();
      if (ctLanguage == 'en') {
        this.document.getElementsByClassName("statusLeft")[0].innerText = "Disconnected";
      } else {
        this.document.getElementsByClassName("statusLeft")[0].innerText = "未连接";
      }
      // 显示'重新连接',隐藏'工作中'图标
      this.document.getElementsByClassName("statusTxt")[0].style.display = "block";
      this.document.getElementsByClassName("statusImg")[0].style.display = "none";
      // 设置禁用状态
      disableControls();
      // 显示连接超时弹窗
      this.document.getElementsByClassName("shelter")[0].style.display = "block";
      this.document.getElementsByClassName("msg-div")[0].style.display = "block";
    } else if (workStatus == 3) { //工作中，空记录
      if (ctLanguage == 'en') {
        this.document.getElementsByClassName("statusLeft")[0].innerText = "Working";
      } else {
        this.document.getElementsByClassName("statusLeft")[0].innerText = "工作中";
      }
      // 关闭超时连接弹框
      $('.shelter').hide();
      $('.msg-div').hide();
      // 显示'工作中'图标,隐藏'重新连接' 
      this.document.getElementsByClassName("statusTxt")[0].style.display = "none";
      this.document.getElementsByClassName("statusImg")[0].style.display = "none";
    } else if (workStatus == 4) { //待机中，充电中， 三条记录
      //TODO
    } else if (workStatus == 5) { //工作中，三条记录
      console.log('工作中')
      clearDataToStart();
      if (ctLanguage == 'en') {
        this.document.getElementsByClassName("statusLeft")[0].innerText = "Working";
      } else {
        this.document.getElementsByClassName("statusLeft")[0].innerText = "工作中";
      }
      // 连接中 icon 隐藏
      this.document.getElementsByClassName("statusImgLoading")[0].style.display = "none";
      // 显示电量
      this.document.getElementsByClassName("statusMiddle")[0].style.display = "block";
      // 显示工作icon
      this.document.getElementsByClassName("statusImg")[0].style.display = "block";
      // this.document.getElementsByClassName("statusImg")[0].style.background = "url('../img/light/ic_quxiao.png') no-repeat";
      this.document.getElementsByClassName("statusImg")[0].style.background =
        "url('http://www.dadaiot.com/cleanerH5/img/light/ic_quxiao.png') no-repeat";
      this.document.getElementsByClassName("statusImg")[0].style.backgroundSize = "cover";

      // 显示节能模式、灯光已开启
      $('.fnStatus').show();
      if (batterFlag == 1) {
        removeBatterFun();
      }

      // 重新连接 隐藏
      this.document.getElementsByClassName("statusTxt")[0].style.display = "none";

      // 关闭超时连接弹框
      $('.shelter').hide();
      $('.msg-div').hide();
      if (lastcleanmin > 0 || lastcleansecond > 0) {
        // 显示上次清扫时间
        $('.workTime').show(); // 显示时间
        $('.initTime').hide(); // 隐藏--

        // 上次清扫记录
        $('.lastcleanmin').html(lastcleanmin)
        $('.lastcleansecond').html(lastcleansecond)

        // 累积清扫记录
        $('.allcleanmin').html(allcleanmin)
        $('.allcleansecond').html(allcleansecond)
      }

      if (recordStatus != 1) {
        sessionStorage.setItem('initCode', 5)
      }
    } else if (workStatus == 6) { //连接中
      clearDataToStart();
      // 关闭超时连接弹框
      $('.shelter').hide();
      $('.msg-div').hide();
      if (ctLanguage == 'en') {
        this.document.getElementsByClassName("statusLeft")[0].innerText = "Connecting";
      } else {
        this.document.getElementsByClassName("statusLeft")[0].innerText = "连接中";
      }
      // this.document.getElementsByClassName("statusLeft")[0].innerText = "Connecting";
      // 显示'重新连接',隐藏'工作中'图标
      this.document.getElementsByClassName("statusImgLoading")[0].style.display = "block";
      this.document.getElementsByClassName("statusImg")[0].style.background =
        "url('../img/loading/loading48.png') no-repeat";
      // 重新连接 隐藏
      this.document.getElementsByClassName("statusTxt")[0].style.display = "none";
      // 设置禁用状态
      disableControls();
    } else if (workStatus == 7) { //待机
      clearDataToStart();
      if (ctLanguage == 'en') {
        this.document.getElementsByClassName("statusLeft")[0].innerText = "Standby";
      } else {
        this.document.getElementsByClassName("statusLeft")[0].innerText = "待机";
      }
      // 显示电量
      this.document.getElementsByClassName("statusMiddle")[0].style.display = "block";
      if (batterFlag == 1) {
        removeBatterFun();
      }
      // 显示工作icon
      this.document.getElementsByClassName("statusImg")[0].style.display = "block";
      this.document.getElementsByClassName("statusImg")[0].style.background =
        "url('http://www.dadaiot.com/cleanerH5/img/light/ic_kaishi.png') no-repeat";
      this.document.getElementsByClassName("statusImg")[0].style.backgroundSize = "cover";

      // 重新连接 隐藏
      this.document.getElementsByClassName("statusTxt")[0].style.display = "none";
      // 设置禁用状态
      this.document.getElementsByClassName("devInfo")[0].classList.add('disable');
      this.document.getElementsByClassName("spinner")[0].classList.add('disable');
      this.document.getElementsByClassName("ledCard")[0].classList.add('disable');
      // 关闭超时连接弹框
      $('.shelter').hide();
      $('.msg-div').hide();
      if (lastcleanmin > 0 || lastcleansecond > 0) {
        // 显示上次清扫时间
        $('.workTime').show(); // 显示时间
        $('.initTime').hide(); // --隐藏

        // 上次清扫记录
        $('.lastcleanmin').html(lastcleanmin)
        $('.lastcleansecond').html(lastcleansecond)

        // 累积清扫记录
        $('.allcleanmin').html(allcleanmin)
        $('.allcleansecond').html(allcleansecond)
      }
      if (recordStatus != 1) {
        sessionStorage.setItem('initCode', 7)
      }
      // 开始工作按钮可以点击
      // statusImgClick();
    }

    if (recordStatus == 0) { //未连接
      //TODO
    } else if (recordStatus == 1) { //重连
      //TODO
    }
  }

  // 栅格化适配
  function gridAdaptation() {
    this.document.getElementsByClassName("statusLeft")[0].classList.add('textAlignCenter')
    this.document.getElementsByClassName("statusRight")[0].classList.add('textAlignCenter')
    console.log('-栅格化适配-')
      // 隐私政策
    this.document.getElementsByClassName("statementPopup")[0].style.width = "calc(50% + 6px)";
    this.document.getElementsByClassName("statementPopup")[0].style.left = "0";
    this.document.getElementsByClassName("statementPopup")[0].style.right = "0";
    this.document.getElementsByClassName("statementPopup")[0].style.top = "0";
    this.document.getElementsByClassName("statementPopup")[0].style.bottom = "0";
    this.document.getElementsByClassName("statementPopup")[0].style.height = "fit-content";
    this.document.getElementsByClassName("statementPopup")[0].style.margin = "auto";
    // 超时弹窗
    this.document.getElementsByClassName("msg-div")[0].style.width = "calc(50% + 6px)";
    this.document.getElementsByClassName("msg-div")[0].style.left = "0";
    this.document.getElementsByClassName("msg-div")[0].style.right = "0";
    this.document.getElementsByClassName("msg-div")[0].style.top = "0";
    this.document.getElementsByClassName("msg-div")[0].style.bottom = "0";
    this.document.getElementsByClassName("msg-div")[0].style.height = "fit-content";
    this.document.getElementsByClassName("msg-div")[0].style.margin = "auto";
  }

  // 弹框截图 模式选择
  document.getElementsByClassName("queding")[0].addEventListener('click', function(event) {
    let lang11 = $("input[name='lang']:checked").val();
    console.log('lang11--', lang11)
    ctLanguage = lang11
    if (ctLanguage == 'en') {
      $('.cn_lang').hide();
      $('.en_lang').show();
    }
    if (ctLanguage == 'zh') {
      $('.cn_lang').show();
      $('.en_lang').hide();
    }

    let zhuti11 = $("input[name='yanse']:checked").val();
    if (zhuti11 == 'anhei') {
      getDarkMode(2);
    } else {
      getDarkMode(1);
    }

    let moshi11 = $("input[name='moshi']:checked").val();
    console.log(moshi11)
    if (moshi11 === '0' || moshi11) {
      if (moshi11 == 5) {
        lastcleanmin = '06'
        lastcleansecond = '36'
        allcleanmin = '36'
        allcleansecond = 20
      }
      initStatus(moshi11, 1);
    }

    let gaojing11 = $("input[name='gaojing1']:checked").val();
    if (gaojing11 === '0' || gaojing11 === '1' || gaojing11 === '2') {
      showErrorTip(gaojing11)
    }
    if (gaojing11 == 3) {
      errorArr = []
      hideAlert();
    }
    if (gaojing11 == 4) {
      errorArr = [0, 1, 2]
      repeatShowErrorTip();
    }

    let shange1 = $("input[name='shange1']:checked").val();
    if (shange1 == 1) {
      gridAdaptation(); // 栅格化适配
    }

    let yinsisss = $("input[name='yinsisss']:checked").val();
    if (yinsisss == 1) {
      backgroundColor.style.display = 'block';
      statementPopup.style.display = 'block';
    }

    document.getElementsByClassName("xuanxiang")[0].style.display = "none";
  })

  // todo end

  function initBack() {
    console.log("启用重写安卓物理返回键 ")
    if (window.hilink) {
      // 启用重写安卓物理返回键
      window.hilink.overrideBackPressed(true, "resultCallback");
      //web页面中需实现该函数，用来获取执行结果
      window.resultCallback = (res) => {
        var result = res; // 请求的返回结果
        console.log('物理返回 goback 请求的返回结果', result)
      }
    }
  }

  // web页面中需实现该函数，用来实现自定义的返回
  function goBack() {
    console.log('物理返回 goback')
    if (window.hilink) {
      unSubscribeBleEventFun(hilinkDevId, deviceIdMac)
      disconnectBleFun();
      window.hilink.finishDeviceActivity();
    }
  }

  $(".devName").click(function() {
    console.log('显示 截图框')
    $('.xuanxiang').show();
  })

  function test() {
    // 显示 截图框
    document.getElementsByClassName("chuxuanx")[0].addEventListener('click', function(event) {
        document.getElementsByClassName("xuanxiang")[0].style.display = "block";
      })
      // 关闭 截图框
    document.getElementsByClassName("guanbix")[0].addEventListener('click', function(event) {
      document.getElementsByClassName("xuanxiang")[0].style.display = "none";
    })
  }

  function removeBatterFun() {
    $('.batterNum')[0].classList.remove('disable');
    $('.batterStatus')[0].classList.remove('disable');
  }

  // desc 获取手机信息，包含系统和屏幕
  function getPhoneInfo() {
    console.log('---------------  手机信息  ---------------')
    let type = 'android';
    let version = '10.0.0';
    let isPad = false;
    let isDarkMode = false;
    let isLandscape = false; // false 竖屏    true 横屏
    let DPR = window.devicePixelRatio; // 设备物理像素和设备独立像素(dips)的比例
    let isScreenSpreaded;
    try {
      let ua = navigator.userAgent.toLowerCase();
      let reg, matchInfo;
      if (ua.indexOf('like mac os x') > 0) {
        reg = /os [\d._]+/gi;
        type = 'ios';
      } else if (ua.indexOf('android') > 0) {
        reg = /android [\d._]+/gi;
        type = 'android';
      } else if (ua.indexOf('harmony') > 0) {
        reg = /harmony [\d._]+/gi;
        type = 'harmony';
      }
      matchInfo = ua.match(reg);
      version = String(matchInfo).replace(/[^0-9|_.]/gi, '').replace(/_/gi, '.');
      if (window.hilink) {
        let screenWidth = window.hilink.screenWidth
        let screenHeight = window.hilink.screenHeight
        if (screenWidth > screenHeight) {
          isLandscape = true;
        }
      }
      isScreenSpreaded = (window.hilink && window.hilink.screenWidth && window.hilink.isScreenSpreaded()) || false, // 折叠屏展开
        isPad = /(?:ipad|playbook)/.test(ua) || (['android', 'harmony'].indexOf(type) !== -1 && !/(?:mobile)/.test(ua)); // 平板
    } catch (err) {
      console.log('通过 navigator.userAgent 获取系统类型和版本报错,使用默认配置android 和 10');
    }
    console.log(`获取type为${type + version}, ${(isPad ? '平板' : '手机') + ',' + (isScreenSpreaded ? '折叠屏' : '非折叠屏') + ',' + (isLandscape ? '横屏' : '竖屏')}`);
    // console.log("isPad: " + isPad);
    // console.log("isScreenSpreaded: " + isScreenSpreaded);
    // console.log("isDarkMode: " + isDarkMode);
    // console.log("DPR: " + DPR);
    if (isScreenSpreaded) {
      console.log('折叠屏')
      sessionStorage.setItem('phoneType', 'isScreenSpreaded')
      gridAdaptation();
    }
    if (isPad && !isLandscape) {
      console.log('pad竖屏')
      sessionStorage.setItem('phoneType', 'isPadVertical')
      gridAdaptation();
    }
    console.log('---------------  手机信息  ---------------')
  }

  $(function() {
    console.log("-- $ init --")

    // 获取手机信息，包含系统和屏幕
    getPhoneInfo();

    var initCode = sessionStorage.getItem('initCode')
    if (initCode) {
      // 进入待机状态
      initStatus(initCode, 0);
    } else {
      initStatus(6, 0);
    }
    // initStatus(workStatus,recordStatus )
    // workStatus 0:未连接 2:连接失败 连接超时 5:工作中，三条记录 6:连接中 7:待机
    // recordStatus 0:未连接 1:重连

    // 启用重写安卓物理返回键
    initBack();

    test()
  })
</script>

</html>